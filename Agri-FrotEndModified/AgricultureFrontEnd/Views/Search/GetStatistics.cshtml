@model AfforestationSearchVM

@{
    ViewBag.Title = "Make Search";
    Layout = "_Layout";
}

<div class="container mt-5">
    <form asp-action="GetStatistics" asp-controller="Search" method="post" 
          class="p-4 bg-light rounded shadow-sm mx-auto" style="max-width: 500px;">
        @Html.AntiForgeryToken()

        <h4 class="mb-4 text-center">Select Duration & Filters</h4>

        <!-- From Date -->
        <div class="mb-3">
            <label asp-for="FromDate" class="form-label"></label>
            <input asp-for="FromDate" type="date" class="form-control" />
            <span asp-validation-for="FromDate" class="text-danger"></span>
        </div>

        <!-- To Date -->
        <div class="mb-3">
            <label asp-for="ToDate" class="form-label"></label>
            <input asp-for="ToDate" type="date" class="form-control" />
            <span asp-validation-for="ToDate" class="text-danger"></span>
        </div>

        <!-- User -->
        <div class="mb-3">
            <label asp-for="SelectedUserId" class="form-label">User Name</label>
            <select asp-for="SelectedUserId" asp-items="Model.Users" class="form-select">
                <option value="">-- Select User --</option>
            </select>
            <span asp-validation-for="SelectedUserId" class="text-danger"></span>
        </div>

        <!-- Location -->
        <div class="mb-3">
            <label asp-for="SelectedLocationId" class="form-label">Location</label>
            <select asp-for="SelectedLocationId" asp-items="Model.Locations" class="form-select">
                <option value="">-- Select Location --</option>
            </select>
            <span asp-validation-for="SelectedLocationId" class="text-danger"></span>
        </div>

        <!-- Tree -->
        <div class="mb-3">
            <label asp-for="SelectedTreeId" class="form-label">Plant Name</label>
            <select asp-for="SelectedTreeId" asp-items="Model.Trees" class="form-select">
                <option value="">-- Select Plant --</option>
            </select>
            <span asp-validation-for="SelectedTreeId" class="text-danger"></span>
        </div>

        <!-- Submit -->
        <button type="submit" class="btn btn-success w-100" style="background-color: #14ae64; box-shadow: none;">
            Search
        </button>
    </form>

    <!-- ===== Last 30 Summary ===== -->
    <div class="mt-5 container">
    <h4 class="text-center mb-4">Summary for Last 30 Days</h4>

    <!-- Data Tables -->
    <div class="row">
        <!-- By Tree -->
        <div class="col-md-6 mb-3">
            <h6 class="text-center text-success fw-bold mb-2">By Plant Name</h6>
            @if (Model.LastMonthSummary?.Any() == true)
            {
                <div class="table-responsive shadow-sm">
                    <table class="table table-striped table-bordered align-middle text-center">
                        <thead class="text-white" style="background-color:#14ae64;">
                            <tr>
                                <th>Plant</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.LastMonthSummary)
                            {
                                <tr>
                                    <td>@item.TreeName</td>
                                    <td>@item.TotalPlanted</td>
                                </tr>
                            }
                            <tr class="fw-bold bg-light">
                                <td>Total</td>
                                <td>@Model.LastMonthSummary.Sum(x => x.TotalPlanted)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info text-center">No data found for the last 30 days.</div>
            }
        </div>

        <!-- By Type -->
        <div class="col-md-6 mb-3">
            <h6 class="text-center text-success fw-bold mb-2">By plant Type</h6>
            @if (Model.TypeSummary?.Any() == true)
            {
                <div class="table-responsive shadow-sm">
                    <table class="table table-striped table-bordered align-middle text-center">
                        <thead class="text-white" style="background-color:#14ae64;">
                            <tr>
                                <th>Type</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.TypeSummary)
                            {
                                <tr>
                                    <td>@item.TypeName</td>
                                    <td>@item.Count</td>
                                </tr>
                            }
                            <tr class="fw-bold bg-light">
                                <td>Total</td>
                                <td>@Model.TypeSummary.Sum(x => x.Count)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info text-center">No type data found.</div>
            }
        </div>
    </div>
</div>

</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
